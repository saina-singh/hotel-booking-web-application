<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  {% block head %}{% endblock %}
</head>

<body>

  <div class="container mt-3" style="max-width: 1100px;">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}
  </div>

  <!-- NAVBAR WRAPPER -->
  <header class="border-bottom bg-white">
    <div class="container py-3">
      <div class="d-flex align-items-center">

        <!-- LEFT: Logo -->
        <a href="{{ url_for('index') }}" class="fw-bold fs-4 text-dark text-decoration-none">
          World Hotels
        </a>

        <!-- CENTER: Navigation -->
        <nav class="mx-auto">
          <div class="d-flex align-items-center nav-center">
            <a href="{{ url_for('index') }}">Discover</a>
            <a href="{{ url_for('hotels') }}">Hotels</a>
            <a href="{{ url_for('gallery') }}">Gallery</a>
            <a href="{{ url_for('deals') }}">Deals</a>
            <a href="{{ url_for('about') }}">About</a>
            <a href="{{ url_for('contact') }}">Contact</a>
          </div>
        </nav>

        <!-- RIGHT: Profile / Auth + Clock -->
        <div class="d-flex align-items-center gap-3">
          <div class="clock-pill d-none d-md-flex flex-column text-end">
            <div class="clock-time" id="navTime">00:00:00</div>
            <div class="clock-date" id="navDate">Loading...</div>
          </div>
          {% if session.get('loggedin') %}
          <a href="{{ url_for('profile') }}" class="profile-circle p-0 overflow-hidden" title="Profile"
            style="width:42px;height:42px;display:flex;align-items:center;justify-content:center;">
            {% if session.get('profile_image') %}
            <img src="{{ url_for('static', filename='uploads/profiles/' ~ session.get('profile_image')) }}"
              alt="Profile" style="width:100%;height:100%;object-fit:cover;">
            {% else %}
            {{ (session.get('email','U'))[0].upper() }}
            {% endif %}
          </a>
          <a class="btn btn-dark btn-sm px-3" href="{{ url_for('logout') }}">Logout</a>
          {% else %}
          <a class="btn btn-outline-dark btn-sm px-3" href="{{ url_for('register') }}#register">
            Register
          </a>

          <a class="btn btn-dark btn-sm px-3" href="{{ url_for('login') }}#login">
            Login
          </a>

          {% endif %}
        </div>

      </div>
    </div>
  </header>

  <!-- Banner image ONLY on these pages -->
  {% if endpoint in ['index', 'login', 'register'] and not endpoint.startswith('admin') %}
  <div class="container my-4">
    <img src="{{ url_for('static', filename='images/hotel_banner.png') }}" class="w-100 rounded-4"
      style="height: 420px; object-fit: cover; object-position: right center;" alt="Hotel Banner">
  </div>
  {% endif %}

  <!-- CTA ONLY when NOT logged in -->
  {% if not session.get('loggedin') and not endpoint.startswith('admin') %}
  <header class="border-bottom bg-white">
    <div class="container my-5 text-center p-5 bg-dark text-white rounded">
      <h3 class="fw-bold">Ready to plan your next trip?</h3>
      <p class="mt-2">Sign up now and get exclusive deals and discounts.</p>
      <a href="{{ url_for('register') }}" class="btn btn-light mt-3">Register Now</a>
  </header>
  </div>
  {% endif %}

  {% block body %}{% endblock %}

  <hr>
  <footer class="text-center text-muted py-3">
    © 2025 WorldHotels.com — All Rights Reserved
  </footer>

  {% if session.get('loggedin') and show_cookie_banner %}
  <div id="cookieBanner" class="cookie-banner">
    <div class="cookie-card">
      <div class="cookie-text">
        <div class="fw-bold">Your cookie preferences</div>
        <div class="text-muted small">
          Choose how we use optional cookies. Necessary cookies are always on.
        </div>
      </div>

      <div class="cookie-actions">
        <a class="btn btn-outline-dark btn-sm" href="{{ url_for('cookies_settings') }}">Manage</a>
        <button id="cookieReject" class="btn btn-outline-dark btn-sm" type="button">Reject optional</button>
        <button id="cookieAccept" class="btn btn-dark btn-sm" type="button">Accept all</button>
      </div>
    </div>
  </div>
  {% endif %}


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Days + months for formatted date
    const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    function updateNavClock() {
      const now = new Date();

      let hours = now.getHours();
      let minutes = now.getMinutes();
      let seconds = now.getSeconds();

      hours = hours < 10 ? "0" + hours : hours;
      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;

      const timeString = `${hours}:${minutes}:${seconds}`;

      const dayName = days[now.getDay()];
      const monthName = months[now.getMonth()];
      const date = now.getDate();
      const year = now.getFullYear();
      const dateString = `${dayName}, ${monthName} ${date}, ${year}`;

      const t = document.getElementById("navTime");
      const d = document.getElementById("navDate");

      // only update if the elements exist (safe for all pages)
      if (t) t.textContent = timeString;
      if (d) d.textContent = dateString;
    }

    updateNavClock();
    setInterval(updateNavClock, 1000);
  </script>

  {% if session.get('loggedin') and show_cookie_banner %}
  <script>
    (function () {
      const banner = document.getElementById("cookieBanner");
      const acceptBtn = document.getElementById("cookieAccept");
      const rejectBtn = document.getElementById("cookieReject");

      if (!banner) return;

      async function quick(action) {
        try {
          await fetch("{{ url_for('cookies_quick') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ action })
          });
        } catch (e) { }
        banner.remove(); // removes banner completely
      }

      acceptBtn?.addEventListener("click", () => quick("accept_all"));
      rejectBtn?.addEventListener("click", () => quick("reject_optional"));
    })();
  </script>
  {% endif %}

  <script>
    (function () {
      // Get today's date in YYYY-MM-DD (local time)
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, "0");
      const dd = String(now.getDate()).padStart(2, "0");
      const today = `${yyyy}-${mm}-${dd}`;

      // Apply to ALL date inputs
      document.querySelectorAll('input[type="date"]').forEach(input => {
        // If no min already set, block past dates
        if (!input.hasAttribute("min")) {
          input.setAttribute("min", today);
        }

        // Extra safety: if value somehow becomes past, clear it
        input.addEventListener("change", () => {
          if (input.value && input.value < today) {
            input.value = "";
          }
        });
      });
    })();
  </script>

</body>

</html>