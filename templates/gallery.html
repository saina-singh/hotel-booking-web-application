{% extends 'base.html' %}

{% block head %}
<title>Gallery</title>
{% endblock %}

{% block body %}

<div class="container my-4">

  <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-3">
    <div>
      <h3 class="fw-bold mb-0">Hotel Gallery</h3>
      <div class="text-muted">Browse photos by room type and category</div>
    </div>

    <div class="d-flex gap-2 align-items-center flex-wrap">
      <!-- Room type filter -->
      <div class="btn-group" role="group" aria-label="Room filter">
        <button type="button" class="btn btn-dark btn-sm filter-room" data-room="all">All</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="standard">Standard</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="double">Double</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="family">Family</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="single">Single</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="deluxe">Deluxe</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="suite">Suite</button>
        <button type="button" class="btn btn-outline-dark btn-sm filter-room" data-room="executive">Executive</button>
      </div>

      <!-- Photo type filter -->
      <select id="typeFilter" class="form-select form-select-sm" style="width: 170px;">
        <option value="all">All photo types</option>
        <option value="room">Room</option>
        <option value="bathroom">Bathroom</option>
        <option value="balcony">Balcony</option>
        <option value="minibar">Mini-bar</option>
        <option value="gym">Gym</option>
        <option value="pool">Pool</option>
      </select>

      <!-- Sort -->
      <select id="sortSelect" class="form-select form-select-sm" style="width: 140px;">
        <option value="az">Sort A–Z</option>
        <option value="za">Sort Z–A</option>
      </select>

      <button class="btn btn-outline-dark btn-sm" id="clearFilters">Clear</button>
    </div>
  </div>

  {# -------------------------
  GALLERY ITEMS (your exact files)
  static/images/gallery/<roomtype>/<image>.jpg
      ------------------------- #}
      {% set gallery_items = [
      {"room":"standard","type":"room","label":"Standard • Room","src":"images/gallery/standard/room.jpg"},
      {"room":"standard","type":"bathroom","label":"Standard • Bathroom","src":"images/gallery/standard/bathroom.jpg"},

      {"room":"single","type":"room","label":"Single • Room","src":"images/gallery/single/room.jpg"},
      {"room":"single","type":"bathroom","label":"Single • Bathroom","src":"images/gallery/single/bathroom.jpg"},
      {"room":"single","type":"minibar","label":"Single • Mini-bar","src":"images/gallery/single/minibar.jpg"},

      {"room":"family","type":"room","label":"Family • Room","src":"images/gallery/family/room.jpg"},
      {"room":"family","type":"bathroom","label":"Family • Bathroom","src":"images/gallery/family/bathroom.jpg"},
      {"room":"family","type":"balcony","label":"Family • Balcony","src":"images/gallery/family/balcony.jpg"},

      {"room":"double","type":"room","label":"Double • Room","src":"images/gallery/double/room.jpg"},
      {"room":"double","type":"bathroom","label":"Double • Bathroom","src":"images/gallery/double/bathroom.jpg"},
      {"room":"double","type":"balcony","label":"Double • Balcony","src":"images/gallery/double/balcony.jpg"},
      {"room":"double","type":"minibar","label":"Double • Mini-bar","src":"images/gallery/double/minibar.jpg"},

      {"room":"deluxe","type":"room","label":"Deluxe • Room","src":"images/gallery/deluxe/room.jpg"},
      {"room":"deluxe","type":"bathroom","label":"Deluxe • Bathroom","src":"images/gallery/deluxe/bathroom.jpg"},
      {"room":"deluxe","type":"balcony","label":"Deluxe • Balcony","src":"images/gallery/deluxe/balcony.jpg"},
      {"room":"deluxe","type":"minibar","label":"Deluxe • Mini-bar","src":"images/gallery/deluxe/minibar.jpg"},

      {"room":"executive","type":"room","label":"Executive • Room","src":"images/gallery/executive/room.jpg"},
      {"room":"executive","type":"bathroom","label":"Executive •
      Bathroom","src":"images/gallery/executive/bathroom.jpg"},
      {"room":"executive","type":"balcony","label":"Executive • Balcony","src":"images/gallery/executive/balcony.jpg"},
      {"room":"executive","type":"minibar","label":"Executive • Mini-bar","src":"images/gallery/executive/minibar.jpg"},
      {"room":"executive","type":"gym","label":"Executive • Gym","src":"images/gallery/executive/gym.jpg"},

      {"room":"suite","type":"room","label":"Suite • Room","src":"images/gallery/suite/room.jpg"},
      {"room":"suite","type":"bathroom","label":"Suite • Bathroom","src":"images/gallery/suite/bathroom.jpg"},
      {"room":"suite","type":"balcony","label":"Suite • Balcony","src":"images/gallery/suite/balcony.jpg"},
      {"room":"suite","type":"minibar","label":"Suite • Mini-bar","src":"images/gallery/suite/minibar.jpg"},
      {"room":"suite","type":"pool","label":"Suite • Pool","src":"images/gallery/suite/pool.jpg"},
      ] %}

      <div class="row g-4" id="galleryGrid">
        {% for img in gallery_items %}
        <div class="col-md-4 col-lg-3 gallery-item" data-room="{{ img.room }}" data-type="{{ img.type }}"
          data-label="{{ img.label|lower }}">
          <div class="card shadow-sm h-100">
            <img src="{{ url_for('static', filename=img.src) }}" class="card-img-top"
              style="height: 190px; object-fit: cover; cursor:pointer;" alt="{{ img.label }}" data-bs-toggle="modal"
              data-bs-target="#imgModal" data-full="{{ url_for('static', filename=img.src) }}"
              data-title="{{ img.label }}">
            <div class="card-body">
              <div class="fw-bold">{{ img.label }}</div>
              <div class="mt-2 d-flex gap-2 flex-wrap">
                <span class="badge bg-dark text-uppercase">{{ img.room }}</span>
                <span class="badge bg-secondary text-uppercase">{{ img.type }}</span>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <p class="text-muted mt-3 d-none" id="noResults">No images match your filters.</p>

</div>

<!-- Modal preview -->
<div class="modal fade" id="imgModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title fw-bold" id="imgModalTitle">Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <img id="imgModalSrc" src="" class="w-100" style="max-height: 70vh; object-fit: cover;">
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS (needed for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  let activeRoom = "all";

  function applyFilters() {
    const type = document.getElementById("typeFilter").value;
    const items = document.querySelectorAll(".gallery-item");
    let shown = 0;

    items.forEach(el => {
      const room = el.dataset.room;
      const t = el.dataset.type;

      const roomOk = (activeRoom === "all") || (room === activeRoom);
      const typeOk = (type === "all") || (t === type);

      const ok = roomOk && typeOk;
      el.classList.toggle("d-none", !ok);
      if (ok) shown++;
    });

    document.getElementById("noResults").classList.toggle("d-none", shown !== 0);
  }

  function applySort() {
    const sortMode = document.getElementById("sortSelect").value;
    const grid = document.getElementById("galleryGrid");
    const items = Array.from(grid.querySelectorAll(".gallery-item"));

    items.sort((a, b) => {
      const A = (a.dataset.label || "").toLowerCase();
      const B = (b.dataset.label || "").toLowerCase();
      return sortMode === "az" ? A.localeCompare(B) : B.localeCompare(A);
    });

    items.forEach(i => grid.appendChild(i));
  }

  // Room buttons
  document.querySelectorAll(".filter-room").forEach(btn => {
    btn.addEventListener("click", () => {
      activeRoom = btn.dataset.room;

      // button styling
      document.querySelectorAll(".filter-room").forEach(b => {
        b.classList.remove("btn-dark");
        b.classList.add("btn-outline-dark");
      });
      btn.classList.add("btn-dark");
      btn.classList.remove("btn-outline-dark");

      applyFilters();
    });
  });

  document.getElementById("typeFilter").addEventListener("change", applyFilters);
  document.getElementById("sortSelect").addEventListener("change", applySort);

  document.getElementById("clearFilters").addEventListener("click", () => {
    activeRoom = "all";

    // reset buttons
    document.querySelectorAll(".filter-room").forEach(b => {
      b.classList.remove("btn-dark");
      b.classList.add("btn-outline-dark");
    });
    document.querySelector('.filter-room[data-room="all"]').classList.add("btn-dark");
    document.querySelector('.filter-room[data-room="all"]').classList.remove("btn-outline-dark");

    document.getElementById("typeFilter").value = "all";
    document.getElementById("sortSelect").value = "az";
    applySort();
    applyFilters();
  });

  // Modal image hook
  document.addEventListener("click", (e) => {
    const img = e.target.closest("img[data-bs-target='#imgModal']");
    if (!img) return;

    document.getElementById("imgModalTitle").textContent = img.dataset.title || "Preview";
    document.getElementById("imgModalSrc").src = img.dataset.full || "";
  });

  // initial
  applySort();
  applyFilters();
</script>

{% endblock %}