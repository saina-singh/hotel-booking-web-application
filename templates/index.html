{% extends 'base.html' %}

{% block head %}
<title>Home</title>
{% endblock %}

{% block body %}

{% if session.get('loggedin') %}

<div class="container mt-2">

  <div class="banner-section">
    <div class="banner-content">
      <h5 class="booking-eyebrow">Start booking now</h5>
      <a href="{{ url_for('hotels') }}" autocomplete="off" class="btn btn-dark mt-2">Start your search</a>
    </div>

    <div id="search" class="search-box search-on-banner shadow bg-white rounded">
      <form method="GET" action="{{ url_for('hotels') }}">
        <div class="row g-3 align-items-end">
          <!-- Location -->
          <div class="col-12 col-lg-3 position-relative">
            <label>Location</label>
            <input id="cityInput" name="city" class="form-control" placeholder="Enter destination" autocomplete="off">

            <div id="citySuggestions" class="city-suggestions d-none"></div>
          </div>

          <!-- Check-in -->
          <div class="col-12 col-lg-3">
            <label>Check-In</label>
            <input type="date" id="checkin" name="checkin" class="form-control" required>
          </div>

          <!-- Check-out -->
          <div class="col-12 col-lg-3">
            <label>Check-Out</label>
            <input type="date" id="checkout" name="checkout" class="form-control" required>
          </div>

          <!-- People -->
          <div class="col-6 col-lg-2">
            <label>People</label>
            <input type="number" name="people" class="form-control" min="1" value="1"
              oninput="if(this.value < 1) this.value = 1;">
          </div>

          <!-- Go button -->
          <div class="col-6 col-lg-1">
            <button class="btn btn-dark w-100">Go</button>
          </div>
        </div>

      </form>
    </div>
  </div>

</div>

<div class="container mt-3">
  <h3 class="fw-bold mb-4">Popular Destinations</h3>

  <div class="row g-4">

    <!-- London -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=London" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/london.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>London</h6>
            <p class="text-muted mb-0">Click to view for more details.</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Edinburgh -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Edinburgh" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/edinburgh.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Edinburgh</h6>
            <p class="text-muted mb-0">Click to view for more details.</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Manchester -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Manchester" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/manchester.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Manchester</h6>
            <p class="text-muted mb-0">Click to view for more details.</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Oxford -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Oxford" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/oxford.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Oxford</h6>
            <p class="text-muted mb-0">Click to view for more details.</p>
          </div>
        </div>
      </a>
    </div>

  </div>
</div>

{% else %}
<div class="container mt-4 text-center">
  <h3 class="fw-bold">Welcome to World Hotels</h3>
  <p class="text-muted">Please login or signup to start booking and explore destinations.</p>
</div>
{% endif %}

<script>
  const cities = [
    "Aberdeen", "Belfast", "Birmingham", "Bristol", "Cardiff", "Edinburgh",
    "Glasgow", "London", "Manchester", "New Castle", "Norwich", "Nottingham",
    "Oxford", "Plymouth", "Swansea", "Bournemouth", "Kent"
  ];

  const cityInput = document.getElementById("cityInput");
  const suggestionsBox = document.getElementById("citySuggestions");

  function showSuggestions(list, query) {
    suggestionsBox.innerHTML = "";

    if (list.length === 0) {
      suggestionsBox.innerHTML = `
        <div class="px-3 py-2 text-muted small">
          No destinations found
        </div>`;
      suggestionsBox.classList.remove("d-none");
      return;
    }

    list.forEach(city => {
      const btn = document.createElement("div");
      btn.className = "city-item";

      const start = city.slice(0, query.length);
      const rest = city.slice(query.length);

      btn.innerHTML = `
        <span class="city-icon">üìç</span>
        <div>
          <div><span class="city-highlight">${start}</span>${rest}</div>
          <div class="city-muted">World Hotels ‚Ä¢ ${city}</div>
        </div>
      `;

      btn.addEventListener("click", () => {
        cityInput.value = city;
        suggestionsBox.classList.add("d-none");
      });

      suggestionsBox.appendChild(btn);
    });

    suggestionsBox.classList.remove("d-none");
  }

  cityInput.addEventListener("input", () => {
    const query = cityInput.value.trim().toLowerCase();

    if (!query) {
      suggestionsBox.classList.add("d-none");
      return;
    }

    const matches = cities
      .filter(c => c.toLowerCase().startsWith(query))
      .slice(0, 8);

    showSuggestions(matches, cityInput.value.trim());
  });

  document.addEventListener("click", (e) => {
    if (!cityInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
      suggestionsBox.classList.add("d-none");
    }
  });
</script>

{% endblock %}