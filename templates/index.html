{% extends 'base.html' %}

{% block head %}
<title>Home</title>
{% endblock %}

{% block body %}

{% if session.get('loggedin') %}

<div class="container mt-2">

  <div class="banner-section">
    <div class="banner-content">
      <h5 class="booking-eyebrow">Start booking now</h5>
      <a href="{{ url_for('hotels') }}" class="btn btn-dark mt-2">Start your search</a>
    </div>

    <div id="search" class="search-box search-on-banner shadow bg-white rounded">
      <form method="GET" action="{{ url_for('hotels') }}">
        <div class="row g-4 align-items-end">
          <div class="col-md-3">
            <label>Location</label>
            <input name="city" class="form-control" placeholder="Enter destination">
          </div>
          <div class="col-md-3">
            <label>Check-In</label>
            <input type="date" id="checkin" name="checkin" class="form-control" required>
          </div>
          <div class="col-md-3">
            <label>Check-Out</label>
            <input type="date" id="checkout" name="checkout" class="form-control" required>
          </div>
          <div class="col-md-2">
            <label>People</label>
            <input type="number" name="people" class="form-control">
          </div>
          <div class="col-md-1">
            <button class="btn btn-dark w-100">Go</button>
          </div>
        </div>
      </form>
    </div>
  </div>

</div>

<div class="container mt-3">
  <h3 class="fw-bold mb-4">Popular Destinations</h3>

  <div class="row g-4">

    <!-- London -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=London" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/london.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>London</h6>
            <p class="text-muted mb-0">Starting from £200/night</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Edinburgh -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Edinburgh" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/edinburgh.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Edinburgh</h6>
            <p class="text-muted mb-0">Starting from £180/night</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Manchester -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Manchester" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/manchester.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Manchester</h6>
            <p class="text-muted mb-0">Starting from £190/night</p>
          </div>
        </div>
      </a>
    </div>

    <!-- Oxford -->
    <div class="col-md-3">
      <a href="{{ url_for('hotels') }}?city=Oxford" class="text-decoration-none text-dark">
        <div class="card shadow-sm h-100">
          <img src="{{ url_for('static', filename='images/hotels/oxford.jpg') }}" class="card-img-top">
          <div class="card-body">
            <h6>Oxford</h6>
            <p class="text-muted mb-0">Starting from £170/night</p>
          </div>
        </div>
      </a>
    </div>

  </div>
</div>

{% else %}
<div class="container mt-4 text-center">
  <h3 class="fw-bold">Welcome to World Hotels</h3>
  <p class="text-muted">Please login or signup to start booking and explore destinations.</p>
</div>
{% endif %}

<script>
  const checkin = document.getElementById("checkin");
  const checkout = document.getElementById("checkout");

  function toISO(d) { return d.toISOString().split("T")[0]; }

  const today = new Date();
  const todayISO = toISO(today);

  // check-in: from today up to today + 3 months
  const maxCheckin = new Date(today);
  maxCheckin.setMonth(maxCheckin.getMonth() + 3);
  const maxCheckinISO = toISO(maxCheckin);

  checkin.min = todayISO;
  checkin.max = maxCheckinISO;

  checkin.addEventListener("change", () => {
    if (!checkin.value) return;

    const ci = new Date(checkin.value);

    // checkout must be at least next day
    const minCO = new Date(ci);
    minCO.setDate(minCO.getDate() + 1);

    // max stay 30 nights
    const maxCO = new Date(ci);
    maxCO.setDate(maxCO.getDate() + 30);

    checkout.min = toISO(minCO);
    checkout.max = toISO(maxCO);

    // if checkout is invalid, clear it
    if (checkout.value && (checkout.value < checkout.min || checkout.value > checkout.max)) {
      checkout.value = "";
    }
  });

  checkout.addEventListener("change", () => {
    if (checkin.value && checkout.value && checkout.value <= checkin.value) {
      alert("Check-out must be after check-in.");
      checkout.value = "";
    }
  });
</script>

{% endblock %}