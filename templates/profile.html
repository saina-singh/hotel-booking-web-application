{% extends 'base.html' %}

{% block head %}
<title>My Profile</title>
{% endblock %}

{% block body %}
<div class="container my-4" style="max-width: 800px;">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h2 class="fw-bold mb-0">My Profile</h2>
      <div class="text-muted">
        Role: {{ me.role }} • Status:
        {% if me.is_active == 1 %} Active {% else %} Inactive {% endif %}
      </div>
    </div>

    {% if session.get('role') == 'ADMIN' %}
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-dark btn-sm">Back to Admin</a>
    {% else %}
    <a href="{{ url_for('user_dashboard') }}" class="btn btn-outline-dark btn-sm">Back to Dashboard</a>
    {% endif %}
  </div>

  {% if msg %}
  <div class="alert alert-info">{{ msg }}</div>
  {% endif %}

  <div class="card shadow-sm">
    <div class="card-body">

      <form method="POST" enctype="multipart/form-data">

        <!-- Profile image row -->
        <div class="d-flex align-items-center gap-3 mb-4">
          <div>
            {% if me.profile_image %}
            <img id="profilePreview" src="{{ url_for('static', filename='uploads/profiles/' ~ me.profile_image) }}"
              class="rounded-circle border" style="width:90px; height:90px; object-fit:cover;" alt="Profile picture">
            {% else %}
            <img id="profilePreview" src="{{ url_for('static', filename='images/default_profile.png') }}"
              class="rounded-circle border" style="width:90px; height:90px; object-fit:cover;" alt="Profile picture">
            {% endif %}
          </div>

          <div class="flex-grow-1">
            <label class="form-label fw-semibold mb-1">Profile picture</label>
            <input type="file" name="profile_image" id="profileImageInput" class="form-control"
              accept=".png,.jpg,.jpeg,.webp">
            <div class="text-muted small mt-1">PNG/JPG/WEBP • Max 2MB</div>
          </div>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">First Name</label>
            <input name="first_name" class="form-control" value="{{ me.first_name }}" required>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Last Name</label>
            <input name="last_name" class="form-control" value="{{ me.last_name }}" required>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Email (locked)</label>
            <input class="form-control" value="{{ me.email }}" disabled>
          </div>

          <div class="col-md-6">
            <label class="form-label fw-semibold">Phone</label>
            <input name="phone" class="form-control" value="{{ me.phone or '' }}" placeholder="Optional">
          </div>

          <div class="col-md-12">
            <label class="form-label fw-semibold">User ID</label>
            <input class="form-control" value="{{ me.user_id }}" disabled>
          </div>
        </div>

        <div class="d-flex gap-2 mt-4">
          <button class="btn btn-dark">Save Changes</button>
          <a class="btn btn-outline-dark" href="{{ url_for('profile') }}">Reset</a>
        </div>

      </form>
    </div>
  </div>

</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("profileImageInput");
    const preview = document.getElementById("profilePreview");

    input.addEventListener("change", () => {
      const file = input.files && input.files[0];
      if (!file) return;

      const url = URL.createObjectURL(file);
      preview.src = url;
    });
  });
</script>
{% endblock %}