{% extends 'base.html' %}
{% block head %}
<title>{{ hotel.hotel_name }} • {{ room.code }}</title>
{% endblock %}

{% block body %}
<div class="container my-4">

  <!-- Breadcrumb -->
  <div class="mb-3">
    <a href="{{ url_for('hotels') }}" class="text-decoration-none text-muted">Hotels</a>
    <span class="text-muted"> / </span>
    <a href="{{ url_for('hotel_details', hotel_id=hotel.hotel_id) }}" class="text-decoration-none text-muted">
      {{ hotel.hotel_name }}
    </a>
    <span class="text-muted"> / </span>
    <span class="fw-semibold">{{ room.code }}</span>
  </div>

  <div class="row g-4 align-items-start">

    <!-- LEFT: Room info -->
    <div class="col-lg-8">
      <div class="card shadow-sm rounded-4">

        <!-- Image: overflow only here -->
        <div class="rounded-top-4 overflow-hidden">
          <img src="{{ url_for('static', filename=room.img) }}" class="w-100" style="height:360px; object-fit:cover;">
        </div>

        <div class="card-body p-4">

          <h2 class="fw-bold mb-1">{{ room.code }}</h2>
          <div class="text-muted mb-3">{{ room.title }}</div>

          <!-- Season pricing controls -->
          <div class="border rounded-4 p-3 p-md-4 bg-light mb-4">
            <form method="GET" action="{{ url_for('room_details', hotel_id=hotel.hotel_id, room_code=room.code) }}">
              <div class="row g-3 align-items-end">

                <div class="col-md-4">
                  <label class="form-label fw-semibold mb-1">Pricing season</label>
                  <select class="form-select" name="season">
                    <option value="" {% if not season_override %}selected{% endif %}>Auto (from check-in)</option>
                    <option value="peak" {% if season_override=='peak' %}selected{% endif %}>Peak</option>
                    <option value="off_peak" {% if season_override=='off_peak' %}selected{% endif %}>Off-Peak</option>
                  </select>
                  <div class="text-muted small mt-1">Choose Peak/Off-Peak manually if needed.</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label fw-semibold mb-1">Check-in date (optional)</label>
                  <input type="date" class="form-control" name="checkin" value="{{ checkin or '' }}">
                  <div class="text-muted small mt-1">Used only when season is “Auto”.</div>
                </div>

                <div class="col-md-4">
                  <button class="btn btn-dark w-100" type="submit">
                    <i class="bi bi-arrow-repeat me-2"></i> Update pricing
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Price -->
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
            <div class="fw-bold fs-4">
              £{{ room.nightly_from_gbp }} <span class="text-muted fs-6 fw-normal">/ night</span>
            </div>

            {% if season %}
            <span class="badge bg-success">
              <i class="bi bi-check2-circle me-1"></i> {{ season }} season pricing
            </span>
            {% endif %}
          </div>

          <div class="text-muted mb-3">
            Max guests: {{ room.max_guests }} • Available rooms: {{ room.rooms_count }}
          </div>

          <!-- Description (this was “missing” because of layout/clipping) -->
          <p class="text-muted mb-4">{{ room.desc }}</p>

          <hr>

          <h6 class="fw-bold">Why choose this room</h6>
          <ul class="text-muted mb-4">
            {% for x in room.why_list %}
            <li>{{ x }}</li>
            {% endfor %}
          </ul>

          <h6 class="fw-bold">Included features</h6>
          {% if room.features_list %}
          <div class="d-flex flex-wrap gap-2">
            {% for f in room.features_list %}
            <span class="badge bg-dark">{{ f }}</span>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-muted">No features listed.</div>
          {% endif %}

        </div>
      </div>
    </div>

    <!-- RIGHT: Booking + payment -->
    <div class="col-lg-4">
      <div class="card shadow-sm position-sticky rounded-4" style="top:20px;">
        <div class="card-body p-4">

          <h5 class="fw-bold mb-2">Book this room</h5>
          <div class="text-muted mb-3">{{ hotel.hotel_name }} • {{ hotel.city }}</div>

          <form method="POST" action="{{ url_for('book', hotel_id=hotel.hotel_id) }}">
            <input type="hidden" name="room_type_id" value="{{ room.room_type_id }}">

            <label class="form-label fw-semibold">Check-in</label>
            <input type="date" class="form-control" name="check_in" required>

            <label class="form-label fw-semibold mt-2">Check-out</label>
            <input type="date" class="form-control" name="check_out" required>

            <div class="row g-2 mt-2">
              <div class="col-6">
                <label class="form-label fw-semibold">Rooms</label>
                <input type="number" class="form-control" name="rooms_qty" value="1" min="1">
              </div>
              <div class="col-6">
                <label class="form-label fw-semibold">Guests</label>
                <input type="number" class="form-control" name="guests" value="1" min="1">
              </div>
            </div>

            <label class="form-label fw-semibold mt-2">Currency</label>
            <select class="form-select" name="currency_code">
              <option value="GBP">GBP</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="NP">NP</option>
            </select>

            <label class="form-label fw-semibold mt-3">Payment method</label>
            <select class="form-select" name="payment_method" id="paymentMethod">
              <option value="CARD">Card</option>
              <option value="PAYPAL">PayPal</option>
              <option value="BANK">Bank Transfer</option>
              <option value="CASH">Pay at Hotel</option>
            </select>

            <button class="btn btn-dark w-100 mt-3">
              Confirm Booking
            </button>

            <div class="text-muted small mt-2">
              Demo payment • No real card details stored
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}